
<div class="p-4 bg-gray-100 dark:bg-gray-900 min-h-full">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-xl font-bold mb-4 dark:text-gray-100">Choose Payment Method</h1>
    <div class="lg:grid lg:grid-cols-3 lg:gap-8">
      
      <!-- Left Column: Payment Options -->
      <div class="lg:col-span-2">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
          <label class="flex items-center p-4 border-b dark:border-gray-700 cursor-pointer" [class.cursor-not-allowed]="!canPayWithWallet()" [class.opacity-50]="!canPayWithWallet()">
            <input type="radio" name="payment" value="Wallet" [checked]="selectedPaymentMethod() === 'Wallet'" (change)="selectPaymentMethod('Wallet')" [disabled]="!canPayWithWallet()" class="h-4 w-4 text-pink-600 focus:ring-pink-500">
            <div class="ml-3">
              <span class="font-semibold dark:text-gray-100">Wallet</span>
              <span class="text-xs text-green-600 dark:text-green-400 ml-2">(Balance: ₹{{ stateService.currentUser()?.walletBalance }})</span>
              @if(!canPayWithWallet()) {
                <p class="text-xs text-red-500 dark:text-red-400">Insufficient balance for this order</p>
              }
            </div>
          </label>
          <label class="flex items-center p-4 border-b dark:border-gray-700 cursor-pointer" [class.cursor-not-allowed]="!isCodAvailableInCart()" [class.opacity-50]="!isCodAvailableInCart()">
            <input type="radio" name="payment" value="COD" [checked]="selectedPaymentMethod() === 'COD'" (change)="selectPaymentMethod('COD')" [disabled]="!isCodAvailableInCart()" class="h-4 w-4 text-pink-600 focus:ring-pink-500">
            <div class="ml-3">
              <span class="font-semibold dark:text-gray-100">Cash On Delivery</span>
              @if(!isCodAvailableInCart()) {
                <p class="text-xs text-red-500 dark:text-red-400">Not available for all items in your cart</p>
              }
            </div>
          </label>
          <label class="flex items-center p-4 border-b dark:border-gray-700 cursor-pointer">
            <input type="radio" name="payment" value="UPI" [checked]="selectedPaymentMethod() === 'UPI'" (change)="selectPaymentMethod('UPI')" class="h-4 w-4 text-pink-600 focus:ring-pink-500">
            <span class="ml-3 font-semibold dark:text-gray-100">UPI & QR Code</span>
          </label>
        </div>
        <div class="hidden lg:block mt-6">
          <button (click)="placeOrder()" class="w-full bg-pink-500 text-white font-bold py-3 rounded-md">
            @if (selectedPaymentMethod() === 'UPI') {
              <span>PROCEED TO PAY</span>
            } @else {
              <span>PAY NOW</span>
            }
          </button>
        </div>
      </div>

      <!-- Right Column: Payment Summary -->
      <div class="lg:col-span-1 mt-6 lg:mt-0">
        <div class="sticky top-20">
          <app-payment-summary></app-payment-summary>
        </div>
      </div>

    </div>
  </div>

  <!-- Sticky Footer for Mobile -->
  <div class="sticky bottom-0 bg-white dark:bg-gray-800 p-4 -mx-4 mt-4 border-t dark:border-gray-700 lg:hidden">
    <div class="flex justify-between items-center mb-2">
       <span class="text-gray-600 dark:text-gray-300">Amount Payable</span>
       <span class="text-xl font-bold dark:text-white">₹{{ cartTotal() | number:'1.0-0' }}</span>
    </div>
    <button (click)="placeOrder()" class="w-full bg-pink-500 text-white font-bold py-3 rounded-md">
      @if (selectedPaymentMethod() === 'UPI') {
        <span>PROCEED TO PAY</span>
      } @else {
        <span>PAY NOW</span>
      }
    </button>
  </div>
</div>
