
<div>
  <h1 class="text-3xl font-bold mb-6">Flash Sale Manager</h1>

  <div class="bg-white shadow-md rounded-lg overflow-x-auto">
    <table class="min-w-full leading-normal">
      <thead>
        <tr class="bg-gray-200 text-gray-600 uppercase text-sm">
          <th class="py-3 px-5 text-left">Product</th>
          <th class="py-3 px-5 text-left">Current Price</th>
          <th class="py-3 px-5 text-left">Flash Sale Status</th>
          <th class="py-3 px-5 text-center">Actions</th>
        </tr>
      </thead>
      <tbody class="text-gray-700">
        @for(product of products(); track product.id) {
          <tr class="border-b border-gray-200 hover:bg-gray-100">
            <td class="py-3 px-5">
              <div class="flex items-center">
                <img [src]="product.images[0]" alt="" class="w-16 h-20 object-cover rounded-md mr-4">
                <div>
                  <span class="font-semibold">{{ product.name }}</span>
                  <p class="text-xs text-gray-500">{{ product.brand }}</p>
                </div>
              </div>
            </td>
            <td class="py-3 px-5">
              <span class="font-semibold">₹{{ product.price }}</span>
              <span class="text-xs line-through ml-1">₹{{ product.originalPrice }}</span>
            </td>
            <td class="py-3 px-5">
              @if(isSaleActive(product)) {
                <div class="text-green-600">
                  <p class="font-bold">Active at ₹{{ product.flashSale!.price }}</p>
                  <p class="text-xs">Ends: {{ product.flashSale!.endDate | date:'short' }}</p>
                </div>
              } @else {
                <span class="text-gray-500">No active sale</span>
              }
            </td>
            <td class="py-3 px-5 text-center">
              @if(isSaleActive(product)) {
                <button (click)="startEditing(product)" class="text-indigo-600 hover:text-indigo-900 mr-4">Edit</button>
                <button (click)="removeFlashSale(product)" class="text-red-600 hover:text-red-900">Remove</button>
              } @else {
                <button (click)="startEditing(product)" class="text-green-600 hover:text-green-900">Create Sale</button>
              }
            </td>
          </tr>
          
          <!-- Editing Row -->
          @if(editingProduct()?.product.id === product.id) {
            <tr class="bg-pink-50">
                <td colspan="4" class="p-4">
                    <h3 class="font-bold mb-2">Editing Flash Sale for "{{ product.name }}"</h3>
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <label class="block text-xs font-medium text-gray-700">Sale Price (₹)</label>
                            <input type="number" [(ngModel)]="editingProduct()!.salePrice" class="w-full px-3 py-2 border rounded-md">
                        </div>
                        <div class="flex-1">
                            <label class="block text-xs font-medium text-gray-700">End Date & Time</label>
                            <input type="datetime-local" [(ngModel)]="editingProduct()!.endDate" class="w-full px-3 py-2 border rounded-md">
                        </div>
                        <div class="flex items-end space-x-2">
                           <button (click)="saveFlashSale()" class="bg-pink-600 text-white font-bold py-2 px-4 rounded-lg">Save</button>
                           <button (click)="cancelEditing()" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </div>
                </td>
            </tr>
          }
        } @empty {
           <tr>
            <td colspan="4" class="text-center py-10">No products found.</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
